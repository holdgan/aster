# Aster 交易系统环境配置样例
# 复制为 .env 后按实际部署填写。
#
# 系统架构简述：协调器 (A) 负责风控和信号生成，执行器 (B/C) 负责下单。
# 目标是维持 B/C 仓位在安全范围内，若 pending 积压则暂停刷量并等待清理。
# 目前所有风险参数都针对 B、C 两台执行端，A 账户不再承担仓位。

# ===== API 凭证 =====
ASTER_A_KEY=your_api_key_here
ASTER_A_SECRET=your_api_secret_here

ASTER_B_KEY=your_api_key_here
ASTER_B_SECRET=your_api_secret_here

ASTER_C_KEY=your_api_key_here
ASTER_C_SECRET=your_api_secret_here

# ===== 服务端地址 =====
SERVER_B_URL=http://server-b-ip:8081
SERVER_C_URL=http://server-c-ip:8082

# ===== 协调器策略参数 =====
# B/C 最大仓位（美元）。取决于保证金：建议 = (保证金 × 杠杆 × 安全边际)。
# 当前配置：1000U保证金 × 10倍杠杆 × 0.6安全系数 = 6000U
# 安全边际：SAFETY_MARGIN=0.95（代码常量），即实际safe_limit = 6000 × 0.95 = 5700U
MAX_POSITION_B_USD=6000.0
MAX_POSITION_C_USD=6000.0

# 协调器每次发单的规模配置
# 推荐使用 COORDINATOR_ORDER_QUANTITY_BTC 直接指定BTC数量（避免USD换算精度损失）
COORDINATOR_ORDER_SIZE_USD=200.0            # USD金额（备用，某些逻辑仍使用）
COORDINATOR_ORDER_QUANTITY_BTC=0.002        # 直接指定BTC数量（推荐，0.002≈226U@113K）
COORDINATOR_MAX_ORDER_BTC=0.005             # 单笔最大BTC（用于紧急平衡，0.005≈565U）

# 刷量冷却时间（秒）。实际执行会加上随机扰动 6-18 秒区间。
VOLUME_COOLDOWN_SECONDS=12.0

# 仓位调节：目标仓位及允许偏差（BTC）。阈值不得小于 0.001。
# 目标仓位：B=0.03 BTC (约3390 USD @ 113K) 多仓，C=-0.03 BTC 空仓，保持净敞口平衡
TARGET_POSITION_BTC_B=0.03
TARGET_POSITION_BTC_C=-0.03
TARGET_POSITION_THRESHOLD_BTC=0.005

# 多次纠偏失败后切换 taker 的最大 maker 尝试次数。
LIMIT_FALLBACK_COUNT=3

# Pending 积压触发条件：达到数量或最大年龄任一即可熔断刷量。
# 订单通常6-7秒成交，给足缓冲时间避免误报。
PENDING_COUNT_THRESHOLD=3
PENDING_AGE_THRESHOLD_SECONDS=12.0

# ===== 增仓策略配置 =====
# 仓位使用率阈值：低于此值时优先增仓，高于此值时保守平衡
# 注意：usage = abs(exposure_usd) / MAX_POSITION_*_USD，需保证MAX_POSITION配置准确
# 策略说明：B固定做多(BUY)，C固定做空(SELL)，采用静态互补方向
INCREASE_POSITION_USAGE_THRESHOLD=0.8       # 80%以下优先增仓，80%以上保守

# 净敞口软限制（美元）：仅作参考值，实际由硬限制+紧急纠偏机制控制
# 与PENDING阈值协调：软限制100U < pending触发12秒 < 硬限制200U
NET_EXPOSURE_SOFT_LIMIT=100.0               # 100U软限制参考值

# 净敞口硬限制（美元）：超过此值强制平衡，不管仓位使用率
NET_EXPOSURE_HARD_LIMIT=200.0               # 200U硬限制，强制平衡

# ===== 执行器参数 =====
# 单笔订单超时时间（秒），超时未成交视为失败并写入 fill 统计。
# 订单通常6-7秒成交，20秒超时给足缓冲时间。
ORDER_EXPIRY_TIME=30.0
PENDING_FAILURE_SECONDS=20.0

# 单笔订单美元上限给执行端兜底使用；协调器会在信号层面控制更严格的额度。
MAX_ORDER_USD=500.0

# 执行端速率限制（每端每分钟最多订单数）。
MAX_ORDERS_PER_MINUTE=30

# ===== 日志与告警 =====
LOG_LEVEL=INFO
ALERT_WEBHOOK_URL=